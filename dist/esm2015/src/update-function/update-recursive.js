import { isArrayState, isFormState, isGroupState, } from '../state';
import { updateArray } from './update-array';
import { updateGroup } from './update-group';
import { ensureState } from './util';
function updateRecursiveSingle(parent, updateFn) {
    return (state) => {
        if (isGroupState(state)) {
            const updateFunctions = Object.keys(state.controls).reduce((agg, key) => Object.assign(agg, {
                [key]: (s, p) => updateRecursiveSingle(p, updateFn)(s),
            }), {});
            state = updateGroup(updateFunctions)(state);
            return updateFn(state, parent);
        }
        if (isArrayState(state)) {
            state = updateArray((s, p) => updateRecursiveSingle(p, updateFn)(s))(state);
            return updateFn(state, parent);
        }
        return updateFn(state, parent);
    };
}
export function updateRecursive(stateOrFunctionOrFunctionArray, updateFnOrUpdateFnArr, ...rest) {
    if (isFormState(stateOrFunctionOrFunctionArray)) {
        const updateFnArr = Array.isArray(updateFnOrUpdateFnArr) ? updateFnOrUpdateFnArr : [updateFnOrUpdateFnArr];
        return updateFnArr.concat(...rest)
            .reduce((s, updateFn) => updateRecursiveSingle(stateOrFunctionOrFunctionArray, updateFn)(s), stateOrFunctionOrFunctionArray);
    }
    let updateFnArr = Array.isArray(stateOrFunctionOrFunctionArray) ? stateOrFunctionOrFunctionArray : [stateOrFunctionOrFunctionArray];
    updateFnArr = updateFnOrUpdateFnArr === undefined ? updateFnArr : updateFnArr.concat(updateFnOrUpdateFnArr);
    return (s) => updateRecursive(ensureState(s), updateFnArr.concat(rest));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlLXJlY3Vyc2l2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25ncngtZm9ybXMvIiwic291cmNlcyI6WyJzcmMvdXBkYXRlLWZ1bmN0aW9uL3VwZGF0ZS1yZWN1cnNpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUdMLFlBQVksRUFDWixXQUFXLEVBQ1gsWUFBWSxHQUNiLE1BQU0sVUFBVSxDQUFDO0FBQ2xCLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQWtCLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdELE9BQU8sRUFBRSxXQUFXLEVBQWMsTUFBTSxRQUFRLENBQUM7QUFFakQsU0FBUyxxQkFBcUIsQ0FBQyxNQUFpQyxFQUFFLFFBQTBFO0lBQzFJLE9BQU8sQ0FBQyxLQUFnQyxFQUE2QixFQUFFO1FBQ3JFLElBQUksWUFBWSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3ZCLE1BQU0sZUFBZSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFO2dCQUMxRixDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBNEIsRUFBRSxDQUE0QixFQUFFLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzdHLENBQUMsRUFBRSxFQUF5QixDQUFDLENBQUM7WUFDL0IsS0FBSyxHQUFHLFdBQVcsQ0FBTSxlQUFlLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNqRCxPQUFPLFFBQVEsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDaEM7UUFFRCxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUN2QixLQUFLLEdBQUcsV0FBVyxDQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMscUJBQXFCLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakYsT0FBTyxRQUFRLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ2hDO1FBRUQsT0FBTyxRQUFRLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLENBQUMsQ0FBQztBQUNKLENBQUM7QUFnRkQsTUFBTSxVQUFVLGVBQWUsQ0FDN0IsOEJBR3NFLEVBQ3RFLHFCQUE2SixFQUM3SixHQUFHLElBQXdFO0lBRTNFLElBQUksV0FBVyxDQUFDLDhCQUE4QixDQUFDLEVBQUU7UUFDL0MsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxQkFBc0IsQ0FBQyxDQUFDO1FBQzVHLE9BQU8sV0FBVyxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQzthQUMvQixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQyw4QkFBOEIsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSw4QkFBOEIsQ0FBQyxDQUFDO0tBQ2hJO0lBRUQsSUFBSSxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0lBQ3BJLFdBQVcsR0FBRyxxQkFBcUIsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQzVHLE9BQU8sQ0FBQyxDQUErQixFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQVMsV0FBVyxDQUFDLENBQUMsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUNoSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWJzdHJhY3RDb250cm9sU3RhdGUsXG4gIEZvcm1TdGF0ZSxcbiAgaXNBcnJheVN0YXRlLFxuICBpc0Zvcm1TdGF0ZSxcbiAgaXNHcm91cFN0YXRlLFxufSBmcm9tICcuLi9zdGF0ZSc7XG5pbXBvcnQgeyB1cGRhdGVBcnJheSB9IGZyb20gJy4vdXBkYXRlLWFycmF5JztcbmltcG9ydCB7IFN0YXRlVXBkYXRlRm5zLCB1cGRhdGVHcm91cCB9IGZyb20gJy4vdXBkYXRlLWdyb3VwJztcbmltcG9ydCB7IGVuc3VyZVN0YXRlLCBQcm9qZWN0Rm4yIH0gZnJvbSAnLi91dGlsJztcblxuZnVuY3Rpb24gdXBkYXRlUmVjdXJzaXZlU2luZ2xlKHBhcmVudDogQWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgdXBkYXRlRm46IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj4pIHtcbiAgcmV0dXJuIChzdGF0ZTogQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pik6IEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4gPT4ge1xuICAgIGlmIChpc0dyb3VwU3RhdGUoc3RhdGUpKSB7XG4gICAgICBjb25zdCB1cGRhdGVGdW5jdGlvbnMgPSBPYmplY3Qua2V5cyhzdGF0ZS5jb250cm9scykucmVkdWNlKChhZ2csIGtleSkgPT4gT2JqZWN0LmFzc2lnbihhZ2csIHtcbiAgICAgICAgW2tleV06IChzOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBwOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+KSA9PiB1cGRhdGVSZWN1cnNpdmVTaW5nbGUocCwgdXBkYXRlRm4pKHMpLFxuICAgICAgfSksIHt9IGFzIFN0YXRlVXBkYXRlRm5zPGFueT4pO1xuICAgICAgc3RhdGUgPSB1cGRhdGVHcm91cDxhbnk+KHVwZGF0ZUZ1bmN0aW9ucykoc3RhdGUpO1xuICAgICAgcmV0dXJuIHVwZGF0ZUZuKHN0YXRlLCBwYXJlbnQpO1xuICAgIH1cblxuICAgIGlmIChpc0FycmF5U3RhdGUoc3RhdGUpKSB7XG4gICAgICBzdGF0ZSA9IHVwZGF0ZUFycmF5PGFueT4oKHMsIHApID0+IHVwZGF0ZVJlY3Vyc2l2ZVNpbmdsZShwLCB1cGRhdGVGbikocykpKHN0YXRlKTtcbiAgICAgIHJldHVybiB1cGRhdGVGbihzdGF0ZSwgcGFyZW50KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdXBkYXRlRm4oc3RhdGUsIHBhcmVudCk7XG4gIH07XG59XG5cbi8qKlxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgYSBmb3JtIGFycmF5IHN0YXRlIGFuZCBvbmUgb3IgbW9yZSB1cGRhdGVcbiAqIGZ1bmN0aW9ucyBhcHBsaWVzIGFsbCB1cGRhdGUgZnVuY3Rpb25zIG9uZSBhZnRlciBhbm90aGVyIHRvIHRoZSBzdGF0ZVxuICogcmVjdXJzaXZlbHksIGkuZS4gdGhlIGZ1bmN0aW9uIGlzIGFwcGxpZWQgdG8gdGhlIHN0YXRlJ3MgY2hpbGRyZW4sXG4gKiB0aGVpciBjaGlsZHJlbiBldGMuXG4gKlxuICogVGhlIGZvbGxvd2luZyBleGFtcGxlIHVzZXMgdGhpcyBmdW5jdGlvbiB0byB2YWxpZGF0ZSBhbGwgY29udHJvbHMgaW4gYVxuICogZ3JvdXAgb3IgYXJyYXkgYXMgcmVxdWlyZWQuXG4gKlxuIGBgYHR5cGVzY3JpcHRcbiBjb25zdCB1cGRhdGVkU3RhdGUgPSB1cGRhdGVSZWN1cnNpdmUoXG4gICBzdGF0ZSxcbiAgIHZhbGlkYXRlPGFueT4ocmVxdWlyZWQpLFxuICk7XG4gYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVSZWN1cnNpdmU8VFZhbHVlPihcbiAgc3RhdGU6IEFic3RyYWN0Q29udHJvbFN0YXRlPFRWYWx1ZT4sXG4gIHVwZGF0ZUZuOiBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+LFxuICAuLi51cGRhdGVGbkFycjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PltdXG4pOiBGb3JtU3RhdGU8VFZhbHVlPjtcblxuLyoqXG4gKiBUaGlzIHVwZGF0ZSBmdW5jdGlvbiB0YWtlcyBhIGZvcm0gYXJyYXkgc3RhdGUgYW5kIGFuIGFycmF5IG9mXG4gKiB1cGRhdGUgZnVuY3Rpb25zIGFwcGxpZXMgYWxsIHVwZGF0ZSBmdW5jdGlvbnMgb25lIGFmdGVyIGFub3RoZXIgdG8gdGhlXG4gKiBzdGF0ZSByZWN1cnNpdmVseSwgaS5lLiB0aGUgZnVuY3Rpb24gaXMgYXBwbGllZCB0byB0aGUgc3RhdGUncyBjaGlsZHJlbixcbiAqIHRoZWlyIGNoaWxkcmVuIGV0Yy5cbiAqXG4gKiBUaGUgZm9sbG93aW5nIGV4YW1wbGUgdXNlcyB0aGlzIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIGFsbCBjb250cm9scyBpbiBhXG4gKiBncm91cCBvciBhcnJheSBhcyByZXF1aXJlZC5cbiAqXG5gYGB0eXBlc2NyaXB0XG5jb25zdCB1cGRhdGVkU3RhdGUgPSB1cGRhdGVSZWN1cnNpdmUoXG4gIHN0YXRlLFxuICBbdmFsaWRhdGU8YW55PihyZXF1aXJlZCldLFxuKTtcbmBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUmVjdXJzaXZlPFRWYWx1ZT4oXG4gIHN0YXRlOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxUVmFsdWU+LFxuICB1cGRhdGVGbkFycjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PltdLFxuKTogRm9ybVN0YXRlPFRWYWx1ZT47XG5cbi8qKlxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgb25lIG9yIG1vcmUgdXBkYXRlIGZ1bmN0aW9ucyBhbmQgcmV0dXJucyBhXG4gKiBwcm9qZWN0aW9uIGZ1bmN0aW9uIHRoYXQgYXBwbGllcyBhbGwgdXBkYXRlIGZ1bmN0aW9ucyBvbmUgYWZ0ZXIgYW5vdGhlciB0b1xuICogYSBmb3JtIHN0YXRlLlxuICpcbiAqIFRoZSBmb2xsb3dpbmcgZXhhbXBsZSB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gdmFsaWRhdGUgYWxsIGNvbnRyb2xzIGluIGFcbiAqIGdyb3VwIGFzIHJlcXVpcmVkLlxuICpcbmBgYHR5cGVzY3JpcHRcbmNvbnN0IHVwZGF0ZUZuID0gdXBkYXRlUmVjdXJzaXZlKHZhbGlkYXRlPGFueT4ocmVxdWlyZWQpKTtcbmNvbnN0IHVwZGF0ZWRTdGF0ZSA9IHVwZGF0ZUZuKHN0YXRlKTtcbmBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUmVjdXJzaXZlKFxuICB1cGRhdGVGbjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PixcbiAgLi4udXBkYXRlRm5BcnI6IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5bXVxuKTogPFRWYWx1ZT4oc3RhdGU6IEFic3RyYWN0Q29udHJvbFN0YXRlPFRWYWx1ZT4pID0+IEZvcm1TdGF0ZTxUVmFsdWU+O1xuXG4vKipcbiAqIFRoaXMgdXBkYXRlIGZ1bmN0aW9uIHRha2VzIGFuIGFycmF5IG9mIHVwZGF0ZSBmdW5jdGlvbnMgYW5kIHJldHVybnNcbiAqIGEgcHJvamVjdGlvbiBmdW5jdGlvbiB0aGF0IGFwcGxpZXMgYWxsIHVwZGF0ZSBmdW5jdGlvbnMgb25lIGFmdGVyIGFub3RoZXIgdG9cbiAqIGEgZm9ybSBzdGF0ZS5cbiAqXG4gKiBUaGUgZm9sbG93aW5nIGV4YW1wbGUgdXNlcyB0aGlzIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIGFsbCBjb250cm9scyBpbiBhXG4gKiBncm91cCBhcyByZXF1aXJlZC5cbiAqXG5gYGB0eXBlc2NyaXB0XG5jb25zdCB1cGRhdGVGbiA9IHVwZGF0ZVJlY3Vyc2l2ZShbdmFsaWRhdGU8YW55PihyZXF1aXJlZCldKTtcbmNvbnN0IHVwZGF0ZWRTdGF0ZSA9IHVwZGF0ZUZuKHN0YXRlKTtcbmBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUmVjdXJzaXZlKFxuICB1cGRhdGVGbkFycjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PltdLFxuKTogPFRWYWx1ZT4oc3RhdGU6IEFic3RyYWN0Q29udHJvbFN0YXRlPFRWYWx1ZT4pID0+IEZvcm1TdGF0ZTxUVmFsdWU+O1xuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUmVjdXJzaXZlPFRWYWx1ZT4oXG4gIHN0YXRlT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheTpcbiAgICB8IEFic3RyYWN0Q29udHJvbFN0YXRlPFRWYWx1ZT5cbiAgICB8IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5cbiAgICB8IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5bXSxcbiAgdXBkYXRlRm5PclVwZGF0ZUZuQXJyPzogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PiB8IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5bXSxcbiAgLi4ucmVzdDogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PltdXG4pIHtcbiAgaWYgKGlzRm9ybVN0YXRlKHN0YXRlT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheSkpIHtcbiAgICBjb25zdCB1cGRhdGVGbkFyciA9IEFycmF5LmlzQXJyYXkodXBkYXRlRm5PclVwZGF0ZUZuQXJyKSA/IHVwZGF0ZUZuT3JVcGRhdGVGbkFyciA6IFt1cGRhdGVGbk9yVXBkYXRlRm5BcnIhXTtcbiAgICByZXR1cm4gdXBkYXRlRm5BcnIuY29uY2F0KC4uLnJlc3QpXG4gICAgICAucmVkdWNlKChzLCB1cGRhdGVGbikgPT4gdXBkYXRlUmVjdXJzaXZlU2luZ2xlKHN0YXRlT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheSwgdXBkYXRlRm4pKHMpLCBzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXkpO1xuICB9XG5cbiAgbGV0IHVwZGF0ZUZuQXJyID0gQXJyYXkuaXNBcnJheShzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXkpID8gc3RhdGVPckZ1bmN0aW9uT3JGdW5jdGlvbkFycmF5IDogW3N0YXRlT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheV07XG4gIHVwZGF0ZUZuQXJyID0gdXBkYXRlRm5PclVwZGF0ZUZuQXJyID09PSB1bmRlZmluZWQgPyB1cGRhdGVGbkFyciA6IHVwZGF0ZUZuQXJyLmNvbmNhdCh1cGRhdGVGbk9yVXBkYXRlRm5BcnIpO1xuICByZXR1cm4gKHM6IEFic3RyYWN0Q29udHJvbFN0YXRlPFRWYWx1ZT4pID0+IHVwZGF0ZVJlY3Vyc2l2ZTxUVmFsdWU+KGVuc3VyZVN0YXRlKHMpLCB1cGRhdGVGbkFyci5jb25jYXQocmVzdCkpO1xufVxuIl19