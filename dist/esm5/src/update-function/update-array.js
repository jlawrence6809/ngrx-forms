import * as tslib_1 from "tslib";
import { computeArrayState, isArrayState } from '../state';
import { ensureState } from './util';
function updateArrayControlsState(filterFn, updateFn) {
    return function (state) {
        var hasChanged = false;
        var newControls = state.controls.map(function (control, idx) {
            if (!filterFn(control, idx)) {
                return control;
            }
            var newControl = updateFn(control, state);
            hasChanged = hasChanged || newControl !== control;
            return newControl;
        });
        return hasChanged ? newControls : state.controls;
    };
}
function updateArraySingle(filterFn, updateFn) {
    return function (state) {
        var newControls = updateArrayControlsState(filterFn, updateFn)(state);
        return newControls !== state.controls
            ? computeArrayState(state.id, newControls, state.value, state.errors, state.pendingValidations, state.userDefinedProperties, {
                wasOrShouldBeDirty: state.isDirty,
                wasOrShouldBeEnabled: state.isEnabled,
                wasOrShouldBeTouched: state.isTouched,
                wasOrShouldBeSubmitted: state.isSubmitted,
            })
            : state;
    };
}
export function updateArrayWithFilter(stateOrFilterFunction, filterFunctionOrFunctionOrFunctionArray, updateFnOrUpdateFnArr) {
    var rest = [];
    for (var _i = 3; _i < arguments.length; _i++) {
        rest[_i - 3] = arguments[_i];
    }
    if (isArrayState(stateOrFilterFunction)) {
        var filterFn_1 = filterFunctionOrFunctionOrFunctionArray;
        var updateFnArr_1 = Array.isArray(updateFnOrUpdateFnArr) ? updateFnOrUpdateFnArr : [updateFnOrUpdateFnArr];
        return updateFnArr_1.concat.apply(updateFnArr_1, tslib_1.__spread(rest)).reduce(function (s, updateFn) { return updateArraySingle(filterFn_1, updateFn)(s); }, stateOrFilterFunction);
    }
    var updateFnArr = Array.isArray(filterFunctionOrFunctionOrFunctionArray)
        ? filterFunctionOrFunctionOrFunctionArray
        : [filterFunctionOrFunctionOrFunctionArray];
    updateFnArr = updateFnOrUpdateFnArr === undefined ? updateFnArr : updateFnArr.concat(updateFnOrUpdateFnArr);
    return function (s) { return updateArrayWithFilter(ensureState(s), stateOrFilterFunction, updateFnArr.concat(rest)); };
}
export function updateArray(stateOrFunctionOrFunctionArray, updateFnOrUpdateFnArr) {
    var rest = [];
    for (var _i = 2; _i < arguments.length; _i++) {
        rest[_i - 2] = arguments[_i];
    }
    if (isArrayState(stateOrFunctionOrFunctionArray)) {
        var updateFnArr_2 = Array.isArray(updateFnOrUpdateFnArr) ? updateFnOrUpdateFnArr : [updateFnOrUpdateFnArr];
        return updateFnArr_2.concat.apply(updateFnArr_2, tslib_1.__spread(rest)).reduce(function (s, updateFn) { return updateArraySingle(function () { return true; }, updateFn)(s); }, stateOrFunctionOrFunctionArray);
    }
    var updateFnArr = Array.isArray(stateOrFunctionOrFunctionArray) ? stateOrFunctionOrFunctionArray : [stateOrFunctionOrFunctionArray];
    updateFnArr = updateFnOrUpdateFnArr === undefined ? updateFnArr : updateFnArr.concat(updateFnOrUpdateFnArr);
    return function (s) { return updateArray(ensureState(s), updateFnArr.concat(rest)); };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlLWFycmF5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmdyeC1mb3Jtcy8iLCJzb3VyY2VzIjpbInNyYy91cGRhdGUtZnVuY3Rpb24vdXBkYXRlLWFycmF5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQTZCLFlBQVksRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUN0RixPQUFPLEVBQUUsV0FBVyxFQUFjLE1BQU0sUUFBUSxDQUFDO0FBSWpELFNBQVMsd0JBQXdCLENBQVMsUUFBMEIsRUFBRSxRQUErRDtJQUNuSSxPQUFPLFVBQUMsS0FBNkI7UUFDbkMsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLElBQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFVBQUMsT0FBTyxFQUFFLEdBQUc7WUFDbEQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLEVBQUU7Z0JBQzNCLE9BQU8sT0FBTyxDQUFDO2FBQ2hCO1lBRUQsSUFBTSxVQUFVLEdBQUcsUUFBUSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztZQUM1QyxVQUFVLEdBQUcsVUFBVSxJQUFJLFVBQVUsS0FBSyxPQUFPLENBQUM7WUFDbEQsT0FBTyxVQUFVLENBQUM7UUFDcEIsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLFVBQVUsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO0lBQ25ELENBQUMsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFTLGlCQUFpQixDQUFTLFFBQTBCLEVBQUUsUUFBK0Q7SUFDNUgsT0FBTyxVQUFDLEtBQTZCO1FBQ25DLElBQU0sV0FBVyxHQUFHLHdCQUF3QixDQUFTLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoRixPQUFPLFdBQVcsS0FBSyxLQUFLLENBQUMsUUFBUTtZQUNuQyxDQUFD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V0FBVyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDNUcsT0FBTyxVQUFDLENBQXlCLElBQUssT0FBQSxXQUFXLENBQVMsV0FBVyxDQUFDLENBQUMsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBN0QsQ0FBNkQsQ0FBQztBQUN0RyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29tcHV0ZUFycmF5U3RhdGUsIEZvcm1BcnJheVN0YXRlLCBGb3JtU3RhdGUsIGlzQXJyYXlTdGF0ZSB9IGZyb20gJy4uL3N0YXRlJztcbmltcG9ydCB7IGVuc3VyZVN0YXRlLCBQcm9qZWN0Rm4yIH0gZnJvbSAnLi91dGlsJztcblxuZXhwb3J0IHR5cGUgRmlsdGVyRm48VFZhbHVlPiA9IChzOiBGb3JtU3RhdGU8VFZhbHVlPiwgaWR4OiBudW1iZXIpID0+IGJvb2xlYW47XG5cbmZ1bmN0aW9uIHVwZGF0ZUFycmF5Q29udHJvbHNTdGF0ZTxUVmFsdWU+KGZpbHRlckZuOiBGaWx0ZXJGbjxUVmFsdWU+LCB1cGRhdGVGbjogUHJvamVjdEZuMjxGb3JtU3RhdGU8VFZhbHVlPiwgRm9ybUFycmF5U3RhdGU8VFZhbHVlPj4pIHtcbiAgcmV0dXJuIChzdGF0ZTogRm9ybUFycmF5U3RhdGU8VFZhbHVlPikgPT4ge1xuICAgIGxldCBoYXNDaGFuZ2VkID0gZmFsc2U7XG4gICAgY29uc3QgbmV3Q29udHJvbHMgPSBzdGF0ZS5jb250cm9scy5tYXAoKGNvbnRyb2wsIGlkeCkgPT4ge1xuICAgICAgaWYgKCFmaWx0ZXJGbihjb250cm9sLCBpZHgpKSB7XG4gICAgICAgIHJldHVybiBjb250cm9sO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBuZXdDb250cm9sID0gdXBkYXRlRm4oY29udHJvbCwgc3RhdGUpO1xuICAgICAgaGFzQ2hhbmdlZCA9IGhhc0NoYW5nZWQgfHwgbmV3Q29udHJvbCAhPT0gY29udHJvbDtcbiAgICAgIHJldHVybiBuZXdDb250cm9sO1xuICAgIH0pO1xuICAgIHJldHVybiBoYXNDaGFuZ2VkID8gbmV3Q29udHJvbHMgOiBzdGF0ZS5jb250cm9scztcbiAgfTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlQXJyYXlTaW5nbGU8VFZhbHVlPihmaWx0ZXJGbjogRmlsdGVyRm48VFZhbHVlPiwgdXBkYXRlRm46IFByb2plY3RGbjI8Rm9ybVN0YXRlPFRWYWx1ZT4sIEZvcm1BcnJheVN0YXRlPFRWYWx1ZT4+KSB7XG4gIHJldHVybiAoc3RhdGU6IEZvcm1BcnJheVN0YXRlPFRWYWx1ZT4pOiBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+ID0+IHtcbiAgICBjb25zdCBuZXdDb250cm9scyA9IHVwZGF0ZUFycmF5Q29udHJvbHNTdGF0ZTxUVmFsdWU+KGZpbHRlckZuLCB1cGRhdGVGbikoc3RhdGUpO1xuICAgIHJldHVybiBuZXdDb250cm9scyAhPT0gc3RhdGUuY29udHJvbHNcbiAgICAgID8gY29tcHV0ZUFycmF5U3RhdGU8VFZhbHVlPihcbiAgICAgICAgc3RhdGUuaWQsXG4gICAgICAgIG5ld0NvbnRyb2xzLFxuICAgICAgICBzdGF0ZS52YWx1ZSxcbiAgICAgICAgc3RhdGUuZXJyb3JzLFxuICAgICAgICBzdGF0ZS5wZW5kaW5nVmFsaWRhdGlvbnMsXG4gICAgICAgIHN0YXRlLnVzZXJEZWZpbmVkUHJvcGVydGllcyxcbiAgICAgICAge1xuICAgICAgICAgIHdhc09yU2hvdWxkQmVEaXJ0eTogc3RhdGUuaXNEaXJ0eSxcbiAgICAgICAgICB3YXNPclNob3VsZEJlRW5hYmxlZDogc3RhdGUuaXNFbmFibGVkLFxuICAgICAgICAgIHdhc09yU2hvdWxkQmVUb3VjaGVkOiBzdGF0ZS5pc1RvdWNoZWQsXG4gICAgICAgICAgd2FzT3JTaG91bGRCZVN1Ym1pdHRlZDogc3RhdGUuaXNTdWJtaXR0ZWQsXG4gICAgICAgIH0sXG4gICAgICApXG4gICAgICA6IHN0YXRlO1xuICB9O1xufVxuXG4vKipcbiAqIFRoaXMgdXBkYXRlIGZ1bmN0aW9uIHRha2VzIGEgZmlsdGVyIGZ1bmN0aW9uIGFuZCBvbmUgb3IgbW9yZSB1cGRhdGUgZnVuY3Rpb25zXG4gKiBhbmQgcmV0dXJucyBhIHByb2plY3Rpb24gZnVuY3Rpb24gdGhhdCBhcHBsaWVzIGFsbCB1cGRhdGUgZnVuY3Rpb25zIG9uZSBhZnRlclxuICogYW5vdGhlciB0byBlYWNoIGVsZW1lbnQgb2YgdGhlIGZvcm0gYXJyYXkgc3RhdGUgZm9yIHdoaWNoIHRoZSBmaWx0ZXIgZnVuY3Rpb25cbiAqIHJldHVybnMgYHRydWVgLlxuICpcbiAqIFRoZSBmb2xsb3dpbmcgKGNvbnRyaXZlZCkgZXhhbXBsZSB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gdmFsaWRhdGUgYWxsIGl0c1xuICogY2hpbGRyZW4gdG8gYmUgcmVxdWlyZWQgYW5kIG1hcmsgdGhlbSBhcyBkaXJ0eS5cbiAqXG5gYGB0eXBlc2NyaXB0XG5jb25zdCBhcnJheVVwZGF0ZUZuID0gdXBkYXRlQXJyYXk8c3RyaW5nPihcbiAgKF8sIGlkeCkgPT4gaWR4ID4gMCxcbiAgdmFsaWRhdGUocmVxdWlyZWQpLFxuICBtYXJrQXNEaXJ0eSxcbik7XG5jb25zdCB1cGRhdGVkU3RhdGUgPSBhcnJheVVwZGF0ZUZuKHN0YXRlKTtcbmBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQXJyYXlXaXRoRmlsdGVyPFRWYWx1ZT4oXG4gIGZpbHRlckZuOiBGaWx0ZXJGbjxUVmFsdWU+LFxuICB1cGRhdGVGbjogUHJvamVjdEZuMjxGb3JtU3RhdGU8VFZhbHVlPiwgRm9ybUFycmF5U3RhdGU8VFZhbHVlPj4sXG4gIC4uLnVwZGF0ZUZuQXJyOiBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+PltdXG4pOiAoc3RhdGU6IEZvcm1BcnJheVN0YXRlPFRWYWx1ZT4pID0+IEZvcm1BcnJheVN0YXRlPFRWYWx1ZT47XG5cbi8qKlxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgYSBmaWx0ZXIgZnVuY3Rpb24gYW5kIGFuIGFycmF5IG9mIHVwZGF0ZSBmdW5jdGlvbnNcbiAqIGFuZCByZXR1cm5zIGEgcHJvamVjdGlvbiBmdW5jdGlvbiB0aGF0IGFwcGxpZXMgYWxsIHVwZGF0ZSBmdW5jdGlvbnMgb25lIGFmdGVyXG4gKiBhbm90aGVyIHRvIGVhY2ggZWxlbWVudCBvZiB0aGUgZm9ybSBhcnJheSBzdGF0ZSBmb3Igd2hpY2ggdGhlIGZpbHRlciBmdW5jdGlvblxuICogcmV0dXJucyBgdHJ1ZWAuXG4gKlxuICogVGhlIGZvbGxvd2luZyAoY29udHJpdmVkKSBleGFtcGxlIHVzZXMgdGhpcyBmdW5jdGlvbiB0byB2YWxpZGF0ZSBhbGwgaXRzXG4gKiBjaGlsZHJlbiB0byBiZSByZXF1aXJlZCBhbmQgbWFyayB0aGVtIGFzIGRpcnR5LlxuICpcbmBgYHR5cGVzY3JpcHRcbmNvbnN0IGFycmF5VXBkYXRlRm4gPSB1cGRhdGVBcnJheTxzdHJpbmc+KFxuICAoXywgaWR4KSA9PiBpZHggPiAwLFxuICBbXG4gICAgdmFsaWRhdGUocmVxdWlyZWQpLFxuICAgIG1hcmtBc0RpcnR5LFxuICBdLFxuKTtcbmNvbnN0IHVwZGF0ZWRTdGF0ZSA9IGFycmF5VXBkYXRlRm4oc3RhdGUpO1xuYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVBcnJheVdpdGhGaWx0ZXI8VFZhbHVlPihcbiAgZmlsdGVyRm46IEZpbHRlckZuPFRWYWx1ZT4sXG4gIHVwZGF0ZUZuQXJyOiBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+PltdLFxuKTogKHN0YXRlOiBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+KSA9PiBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+O1xuXG4vKipcbiAqIFRoaXMgdXBkYXRlIGZ1bmN0aW9uIHRha2VzIGEgZm9ybSBhcnJheSBzdGF0ZSwgYSBmaWx0ZXIgZnVuY3Rpb24sIGFuZCBhIHZhcmlhYmxlXG4gKiBudW1iZXIgb2YgdXBkYXRlIGZ1bmN0aW9ucyBhbmQgYXBwbGllcyBhbGwgdXBkYXRlIGZ1bmN0aW9ucyBvbmUgYWZ0ZXIgYW5vdGhlciB0b1xuICogZWFjaCBlbGVtZW50IG9mIHRoZSBmb3JtIGFycmF5IHN0YXRlIGZvciB3aGljaCB0aGUgZmlsdGVyIGZ1bmN0aW9uIHJldHVybnMgYHRydWVgLlxuICpcbiAqIFRoZSBmb2xsb3dpbmcgKGNvbnRyaXZlZCkgZXhhbXBsZSB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gdmFsaWRhdGUgYWxsIGl0c1xuICogY2hpbGRyZW4gdG8gYmUgcmVxdWlyZWQgYW5kIG1hcmsgdGhlbSBhcyBkaXJ0eS5cbiAqXG5gYGB0eXBlc2NyaXB0XG5jb25zdCB1cGRhdGVkU3RhdGUgPSB1cGRhdGVBcnJheTxzdHJpbmc+KFxuICBzdGF0ZSxcbiAgKF8sIGlkeCkgPT4gaWR4ID4gMCxcbiAgdmFsaWRhdGUocmVxdWlyZWQpLFxuICBtYXJrQXNEaXJ0eSxcbik7XG5gYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUFycmF5V2l0aEZpbHRlcjxUVmFsdWU+KFxuICBzdGF0ZTogRm9ybUFycmF5U3RhdGU8VFZhbHVlPixcbiAgZmlsdGVyRm46IEZpbHRlckZuPFRWYWx1ZT4sXG4gIHVwZGF0ZUZuOiBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+PixcbiAgLi4udXBkYXRlRm5BcnI6IFByb2plY3RGbjI8Rm9ybVN0YXRlPFRWYWx1ZT4sIEZvcm1BcnJheVN0YXRlPFRWYWx1ZT4+W11cbik6IEZvcm1BcnJheVN0YXRlPFRWYWx1ZT47XG5cbi8qKlxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgYSBmb3JtIGFycmF5IHN0YXRlLCBhIGZpbHRlciBmdW5jdGlvbiwgYW5kIGFuIGFycmF5IG9mXG4gKiB1cGRhdGUgZnVuY3Rpb25zIGFuZCBhcHBsaWVzIGFsbCB1cGRhdGUgZnVuY3Rpb25zIG9uZSBhZnRlciBhbm90aGVyIHRvIGVhY2hcbiAqIGVsZW1lbnQgb2YgdGhlIGZvcm0gYXJyYXkgc3RhdGUgZm9yIHdoaWNoIHRoZSBmaWx0ZXIgZnVuY3Rpb24gcmV0dXJucyBgdHJ1ZWAuXG4gKlxuICogVGhlIGZvbGxvd2luZyAoY29udHJpdmVkKSBleGFtcGxlIHVzZXMgdGhpcyBmdW5jdGlvbiB0byB2YWxpZGF0ZSBhbGwgaXRzXG4gKiBjaGlsZHJlbiB0byBiZSByZXF1aXJlZCBhbmQgbWFyayB0aGVtIGFzIGRpcnR5LlxuICpcbmBgYHR5cGVzY3JpcHRcbmNvbnN0IHVwZGF0ZWRTdGF0ZSA9IHVwZGF0ZUFycmF5PHN0cmluZz4oXG4gIHN0YXRlLFxuICAoXywgaWR4KSA9PiBpZHggPiAwLFxuICBbXG4gICAgdmFsaWRhdGUocmVxdWlyZWQpLFxuICAgIG1hcmtBc0RpcnR5LFxuICBdLFxuKTtcbmBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQXJyYXlXaXRoRmlsdGVyPFRWYWx1ZT4oXG4gIHN0YXRlOiBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+LFxuICBmaWx0ZXJGbjogRmlsdGVyRm48VFZhbHVlPixcbiAgdXBkYXRlRm5BcnI6IFByb2plY3RGbjI8Rm9ybVN0YXRlPFRWYWx1ZT4sIEZvcm1BcnJheVN0YXRlPFRWYWx1ZT4+W10sXG4pOiBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+O1xuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlQXJyYXlXaXRoRmlsdGVyPFRWYWx1ZT4oXG4gIHN0YXRlT3JGaWx0ZXJGdW5jdGlvbjogRm9ybUFycmF5U3RhdGU8VFZhbHVlPiB8IEZpbHRlckZuPFRWYWx1ZT4sXG4gIGZpbHRlckZ1bmN0aW9uT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheTpcbiAgICB8IEZpbHRlckZuPFRWYWx1ZT5cbiAgICB8IFByb2plY3RGbjI8Rm9ybVN0YXRlPFRWYWx1ZT4sIEZvcm1BcnJheVN0YXRlPFRWYWx1ZT4+XG4gICAgfCBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+PltdLFxuICB1cGRhdGVGbk9yVXBkYXRlRm5BcnI/OiBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+PiB8IFByb2plY3RGbjI8Rm9ybVN0YXRlPFRWYWx1ZT4sIEZvcm1BcnJheVN0YXRlPFRWYWx1ZT4+W10sXG4gIC4uLnJlc3Q6IFByb2plY3RGbjI8Rm9ybVN0YXRlPFRWYWx1ZT4sIEZvcm1BcnJheVN0YXRlPFRWYWx1ZT4+W11cbikge1xuICBpZiAoaXNBcnJheVN0YXRlPFRWYWx1ZT4oc3RhdGVPckZpbHRlckZ1bmN0aW9uKSkge1xuICAgIGNvbnN0IGZpbHRlckZuID0gZmlsdGVyRnVuY3Rpb25PckZ1bmN0aW9uT3JGdW5jdGlvbkFycmF5IGFzIEZpbHRlckZuPFRWYWx1ZT47XG4gICAgY29uc3QgdXBkYXRlRm5BcnIgPSBBcnJheS5pc0FycmF5KHVwZGF0ZUZuT3JVcGRhdGVGbkFycikgPyB1cGRhdGVGbk9yVXBkYXRlRm5BcnIgOiBbdXBkYXRlRm5PclVwZGF0ZUZuQXJyIV07XG4gICAgcmV0dXJuIHVwZGF0ZUZuQXJyLmNvbmNhdCguLi5yZXN0KS5yZWR1Y2UoKHMsIHVwZGF0ZUZuKSA9PiB1cGRhdGVBcnJheVNpbmdsZTxUVmFsdWU+KGZpbHRlckZuLCB1cGRhdGVGbikocyksIHN0YXRlT3JGaWx0ZXJGdW5jdGlvbik7XG4gIH1cblxuICBsZXQgdXBkYXRlRm5BcnIgPSBBcnJheS5pc0FycmF5KGZpbHRlckZ1bmN0aW9uT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheSlcbiAgICA/IGZpbHRlckZ1bmN0aW9uT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheVxuICAgIDogW2ZpbHRlckZ1bmN0aW9uT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheSBhcyBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+Pl07XG4gIHVwZGF0ZUZuQXJyID0gdXBkYXRlRm5PclVwZGF0ZUZuQXJyID09PSB1bmRlZmluZWQgPyB1cGRhdGVGbkFyciA6IHVwZGF0ZUZuQXJyLmNvbmNhdCh1cGRhdGVGbk9yVXBkYXRlRm5BcnIpO1xuICByZXR1cm4gKHM6IEZvcm1BcnJheVN0YXRlPFRWYWx1ZT4pID0+IHVwZGF0ZUFycmF5V2l0aEZpbHRlcjxUVmFsdWU+KGVuc3VyZVN0YXRlKHMpLCBzdGF0ZU9yRmlsdGVyRnVuY3Rpb24sIHVwZGF0ZUZuQXJyLmNvbmNhdChyZXN0KSk7XG59XG5cbi8qKlxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgb25lIG9yIG1vcmUgdXBkYXRlIGZ1bmN0aW9ucyBhbmQgcmV0dXJucyBhXG4gKiBwcm9qZWN0aW9uIGZ1bmN0aW9uIHRoYXQgYXBwbGllcyBhbGwgdXBkYXRlIGZ1bmN0aW9ucyBvbmUgYWZ0ZXIgYW5vdGhlciB0b1xuICogZWFjaCBlbGVtZW50IG9mIHRoZSBmb3JtIGFycmF5IHN0YXRlLlxuICpcbiAqIFRoZSBmb2xsb3dpbmcgKGNvbnRyaXZlZCkgZXhhbXBsZSB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gdmFsaWRhdGUgYWxsIGl0c1xuICogY2hpbGRyZW4gdG8gYmUgcmVxdWlyZWQgYW5kIG1hcmsgdGhlbSBhcyBkaXJ0eS5cbiAqXG5gYGB0eXBlc2NyaXB0XG5jb25zdCBhcnJheVVwZGF0ZUZuID0gdXBkYXRlQXJyYXk8c3RyaW5nPihcbiAgdmFsaWRhdGU8c3RyaW5nPihyZXF1aXJlZCksXG4gIG1hcmtBc0RpcnR5LFxuKTtcbmNvbnN0IHVwZGF0ZWRTdGF0ZSA9IGFycmF5VXBkYXRlRm4oc3RhdGUpO1xuYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVBcnJheTxUVmFsdWU+KFxuICB1cGRhdGVGbjogUHJvamVjdEZuMjxGb3JtU3RhdGU8VFZhbHVlPiwgRm9ybUFycmF5U3RhdGU8VFZhbHVlPj4sXG4gIC4uLnVwZGF0ZUZuQXJyOiBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+PltdXG4pOiAoc3RhdGU6IEZvcm1BcnJheVN0YXRlPFRWYWx1ZT4pID0+IEZvcm1BcnJheVN0YXRlPFRWYWx1ZT47XG5cbi8qKlxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgYW4gYXJyYXkgb2YgdXBkYXRlIGZ1bmN0aW9ucyBhbmQgcmV0dXJuc1xuICogYSBwcm9qZWN0aW9uIGZ1bmN0aW9uIHRoYXQgYXBwbGllcyBhbGwgdXBkYXRlIGZ1bmN0aW9ucyBvbmUgYWZ0ZXIgYW5vdGhlciB0b1xuICogZWFjaCBlbGVtZW50IG9mIHRoZSBmb3JtIGFycmF5IHN0YXRlLlxuICpcbiAqIFRoZSBmb2xsb3dpbmcgKGNvbnRyaXZlZCkgZXhhbXBsZSB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gdmFsaWRhdGUgYWxsIGl0c1xuICogY2hpbGRyZW4gdG8gYmUgcmVxdWlyZWQgYW5kIG1hcmsgdGhlbSBhcyBkaXJ0eS5cbiAqXG5gYGB0eXBlc2NyaXB0XG5jb25zdCBhcnJheVVwZGF0ZUZuID0gdXBkYXRlQXJyYXk8c3RyaW5nPihbXG4gIHZhbGlkYXRlPHN0cmluZz4ocmVxdWlyZWQpLFxuICBtYXJrQXNEaXJ0eSxcbl0pO1xuY29uc3QgdXBkYXRlZFN0YXRlID0gYXJyYXlVcGRhdGVGbihzdGF0ZSk7XG5gYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUFycmF5PFRWYWx1ZT4oXG4gIHVwZGF0ZUZuQXJyOiBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+PltdLFxuKTogKHN0YXRlOiBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+KSA9PiBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+O1xuXG4vKipcbiAqIFRoaXMgdXBkYXRlIGZ1bmN0aW9uIHRha2VzIGEgZm9ybSBhcnJheSBzdGF0ZSBhbmQgb25lIG9yIG1vcmUgdXBkYXRlIGZ1bmN0aW9uc1xuICogYW5kIGFwcGxpZXMgYWxsIHVwZGF0ZSBmdW5jdGlvbnMgb25lIGFmdGVyIGFub3RoZXIgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBmb3JtXG4gKiBhcnJheSBzdGF0ZS5cbiAqXG4gKiBUaGUgZm9sbG93aW5nIChjb250cml2ZWQpIGV4YW1wbGUgdXNlcyB0aGlzIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIGFsbCBpdHNcbiAqIGNoaWxkcmVuIHRvIGJlIHJlcXVpcmVkIGFuZCBtYXJrIHRoZW0gYXMgZGlydHkuXG4gKlxuYGBgdHlwZXNjcmlwdFxuY29uc3QgdXBkYXRlZFN0YXRlID0gdXBkYXRlQXJyYXk8c3RyaW5nPihcbiAgc3RhdGUsXG4gIHZhbGlkYXRlPHN0cmluZz4ocmVxdWlyZWQpLFxuICBtYXJrQXNEaXJ0eSxcbik7XG5gYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUFycmF5PFRWYWx1ZT4oXG4gIHN0YXRlOiBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+LFxuICB1cGRhdGVGbjogUHJvamVjdEZuMjxGb3JtU3RhdGU8VFZhbHVlPiwgRm9ybUFycmF5U3RhdGU8VFZhbHVlPj4sXG4gIC4uLnVwZGF0ZUZuQXJyOiBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+PltdXG4pOiBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+O1xuXG4vKipcbiAqIFRoaXMgdXBkYXRlIGZ1bmN0aW9uIHRha2VzIGEgZm9ybSBhcnJheSBzdGF0ZSBhbmQgYW4gYXJyYXkgb2YgdXBkYXRlXG4gKiBmdW5jdGlvbnMgYW5kIGFwcGxpZXMgYWxsIHVwZGF0ZSBmdW5jdGlvbnMgb25lIGFmdGVyIGFub3RoZXIgdG8gZWFjaCBlbGVtZW50XG4gKiBvZiB0aGUgZm9ybSBhcnJheSBzdGF0ZS5cbiAqXG4gKiBUaGUgZm9sbG93aW5nIChjb250cml2ZWQpIGV4YW1wbGUgdXNlcyB0aGlzIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIGFsbCBpdHNcbiAqIGNoaWxkcmVuIHRvIGJlIHJlcXVpcmVkIGFuZCBtYXJrIHRoZW0gYXMgZGlydHkuXG4gKlxuYGBgdHlwZXNjcmlwdFxuY29uc3QgdXBkYXRlZFN0YXRlID0gdXBkYXRlQXJyYXk8c3RyaW5nPihcbiAgc3RhdGUsXG4gIFtcbiAgICB2YWxpZGF0ZTxzdHJpbmc+KHJlcXVpcmVkKSxcbiAgICBtYXJrQXNEaXJ0eSxcbiAgXSxcbik7XG5gYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUFycmF5PFRWYWx1ZT4oXG4gIHN0YXRlOiBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+LFxuICB1cGRhdGVGbkFycjogUHJvamVjdEZuMjxGb3JtU3RhdGU8VFZhbHVlPiwgRm9ybUFycmF5U3RhdGU8VFZhbHVlPj5bXSxcbik6IEZvcm1BcnJheVN0YXRlPFRWYWx1ZT47XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVBcnJheTxUVmFsdWU+KFxuICBzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXk6XG4gICAgfCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+XG4gICAgfCBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+PlxuICAgIHwgUHJvamVjdEZuMjxGb3JtU3RhdGU8VFZhbHVlPiwgRm9ybUFycmF5U3RhdGU8VFZhbHVlPj5bXSxcbiAgdXBkYXRlRm5PclVwZGF0ZUZuQXJyPzogUHJvamVjdEZuMjxGb3JtU3RhdGU8VFZhbHVlPiwgRm9ybUFycmF5U3RhdGU8VFZhbHVlPj4gfCBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+PltdLFxuICAuLi5yZXN0OiBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWU+LCBGb3JtQXJyYXlTdGF0ZTxUVmFsdWU+PltdXG4pIHtcbiAgaWYgKGlzQXJyYXlTdGF0ZTxUVmFsdWU+KHN0YXRlT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheSkpIHtcbiAgICBjb25zdCB1cGRhdGVGbkFyciA9IEFycmF5LmlzQXJyYXkodXBkYXRlRm5PclVwZGF0ZUZuQXJyKSA/IHVwZGF0ZUZuT3JVcGRhdGVGbkFyciA6IFt1cGRhdGVGbk9yVXBkYXRlRm5BcnIhXTtcbiAgICByZXR1cm4gdXBkYXRlRm5BcnIuY29uY2F0KC4uLnJlc3QpLnJlZHVjZSgocywgdXBkYXRlRm4pID0+IHVwZGF0ZUFycmF5U2luZ2xlPFRWYWx1ZT4oKCkgPT4gdHJ1ZSwgdXBkYXRlRm4pKHMpLCBzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXkpO1xuICB9XG5cbiAgbGV0IHVwZGF0ZUZuQXJyID0gQXJyYXkuaXNBcnJheShzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXkpID8gc3RhdGVPckZ1bmN0aW9uT3JGdW5jdGlvbkFycmF5IDogW3N0YXRlT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheV07XG4gIHVwZGF0ZUZuQXJyID0gdXBkYXRlRm5PclVwZGF0ZUZuQXJyID09PSB1bmRlZmluZWQgPyB1cGRhdGVGbkFyciA6IHVwZGF0ZUZuQXJyLmNvbmNhdCh1cGRhdGVGbk9yVXBkYXRlRm5BcnIpO1xuICByZXR1cm4gKHM6IEZvcm1BcnJheVN0YXRlPFRWYWx1ZT4pID0+IHVwZGF0ZUFycmF5PFRWYWx1ZT4oZW5zdXJlU3RhdGUocyksIHVwZGF0ZUZuQXJyLmNvbmNhdChyZXN0KSk7XG59XG4iXX0=