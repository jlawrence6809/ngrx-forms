import * as tslib_1 from "tslib";
import { isArrayState, isFormState, isGroupState, } from '../state';
import { updateArray } from './update-array';
import { updateGroup } from './update-group';
import { ensureState } from './util';
function updateRecursiveSingle(parent, updateFn) {
    return function (state) {
        if (isGroupState(state)) {
            var updateFunctions = Object.keys(state.controls).reduce(function (agg, key) {
                var _a;
                return Object.assign(agg, (_a = {},
                    _a[key] = function (s, p) { return updateRecursiveSingle(p, updateFn)(s); },
                    _a));
            }, {});
            state = updateGroup(updateFunctions)(state);
            return updateFn(state, parent);
        }
        if (isArrayState(state)) {
            state = updateArray(function (s, p) { return updateRecursiveSingle(p, updateFn)(s); })(state);
            return updateFn(state, parent);
        }
        return updateFn(state, parent);
    };
}
export function updateRecursive(stateOrFunctionOrFunctionArray, updateFnOrUpdateFnArr) {
    var rest = [];
    for (var _i = 2; _i < arguments.length; _i++) {
        rest[_i - 2] = arguments[_i];
    }
    if (isFormState(stateOrFunctionOrFunctionArray)) {
        var updateFnArr_1 = Array.isArray(updateFnOrUpdateFnArr) ? updateFnOrUpdateFnArr : [updateFnOrUpdateFnArr];
        return updateFnArr_1.concat.apply(updateFnArr_1, tslib_1.__spread(rest)).reduce(function (s, updateFn) { return updateRecursiveSingle(stateOrFunctionOrFunctionArray, updateFn)(s); }, stateOrFunctionOrFunctionArray);
    }
    var updateFnArr = Array.isArray(stateOrFunctionOrFunctionArray) ? stateOrFunctionOrFunctionArray : [stateOrFunctionOrFunctionArray];
    updateFnArr = updateFnOrUpdateFnArr === undefined ? updateFnArr : updateFnArr.concat(updateFnOrUpdateFnArr);
    return function (s) { return updateRecursive(ensureState(s), updateFnArr.concat(rest)); };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlLXJlY3Vyc2l2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25ncngtZm9ybXMvIiwic291cmNlcyI6WyJzcmMvdXBkYXRlLWZ1bmN0aW9uL3VwZGF0ZS1yZWN1cnNpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFHTCxZQUFZLEVBQ1osV0FBVyxFQUNYLFlBQVksR0FDYixNQUFNLFVBQVUsQ0FBQztBQUNsQixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFrQixXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3RCxPQUFPLEVBQUUsV0FBVyxFQUFjLE1BQU0sUUFBUSxDQUFDO0FBRWpELFNBQVMscUJBQXFCLENBQUMsTUFBaUMsRUFBRSxRQUEwRTtJQUMxSSxPQUFPLFVBQUMsS0FBZ0M7UUFDdEMsSUFBSSxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDdkIsSUFBTSxlQUFlLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBRyxFQUFFLEdBQUc7O2dCQUFLLE9BQUEsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHO29CQUN4RixHQUFDLEdBQUcsSUFBRyxVQUFDLENBQTRCLEVBQUUsQ0FBNEIsSUFBSyxPQUFBLHFCQUFxQixDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBckMsQ0FBcUM7d0JBQzVHO1lBRnVFLENBRXZFLEVBQUUsRUFBeUIsQ0FBQyxDQUFDO1lBQy9CLEtBQUssR0FBRyxXQUFXLENBQU0sZUFBZSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakQsT0FBTyxRQUFRLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ2hDO1FBRUQsSUFBSSxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDdkIsS0FBSyxHQUFHLFdBQVcsQ0FBTSxVQUFDLENBQUMsRUFBRSxDQUFDLElBQUssT0FBQSxxQkFBcUIsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQXJDLENBQXFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNqRixPQUFPLFFBQVEsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDaEM7UUFFRCxPQUFPLFFBQVEsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDakMsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQWdGRCxNQUFNLFVBQVUsZUFBZSxDQUM3Qiw4QkFHc0UsRUFDdEUscUJBQTZKO0lBQzdKLGNBQTJFO1NBQTNFLFVBQTJFLEVBQTNFLHFCQUEyRSxFQUEzRSxJQUEyRTtRQUEzRSw2QkFBMkU7O0lBRTNFLElBQUksV0FBVyxDQUFDLDhCQUE4QixDQUFDLEVBQUU7UUFDL0MsSUFBTSxhQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxQkFBc0IsQ0FBQyxDQUFDO1FBQzVHLE9BQU8sYUFBVyxDQUFDLE1BQU0sT0FBbEIsYUFBVyxtQkFBVyxJQUFJLEdBQzlCLE1BQU0sQ0FBQyxVQUFDLENBQUMsRUFBRSxRQUFRLElBQUssT0FBQSxxQkFBcUIsQ0FBQyw4QkFBOEIsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBbEUsQ0FBa0UsRUFBRSw4QkFBOEIsQ0FBQyxDQUFDO0tBQ2hJO0lBRUQsSUFBSSxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0lBQ3BJLFdBQVcsR0FBRyxxQkFBcUIsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQzVHLE9BQU8sVUFBQyxDQUErQixJQUFLLE9BQUEsZUFBZSxDQUFTLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQWpFLENBQWlFLENBQUM7QUFDaEgsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFic3RyYWN0Q29udHJvbFN0YXRlLFxuICBGb3JtU3RhdGUsXG4gIGlzQXJyYXlTdGF0ZSxcbiAgaXNGb3JtU3RhdGUsXG4gIGlzR3JvdXBTdGF0ZSxcbn0gZnJvbSAnLi4vc3RhdGUnO1xuaW1wb3J0IHsgdXBkYXRlQXJyYXkgfSBmcm9tICcuL3VwZGF0ZS1hcnJheSc7XG5pbXBvcnQgeyBTdGF0ZVVwZGF0ZUZucywgdXBkYXRlR3JvdXAgfSBmcm9tICcuL3VwZGF0ZS1ncm91cCc7XG5pbXBvcnQgeyBlbnN1cmVTdGF0ZSwgUHJvamVjdEZuMiB9IGZyb20gJy4vdXRpbCc7XG5cbmZ1bmN0aW9uIHVwZGF0ZVJlY3Vyc2l2ZVNpbmdsZShwYXJlbnQ6IEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIHVwZGF0ZUZuOiBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+KSB7XG4gIHJldHVybiAoc3RhdGU6IEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4pOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+ID0+IHtcbiAgICBpZiAoaXNHcm91cFN0YXRlKHN0YXRlKSkge1xuICAgICAgY29uc3QgdXBkYXRlRnVuY3Rpb25zID0gT2JqZWN0LmtleXMoc3RhdGUuY29udHJvbHMpLnJlZHVjZSgoYWdnLCBrZXkpID0+IE9iamVjdC5hc3NpZ24oYWdnLCB7XG4gICAgICAgIFtrZXldOiAoczogQWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgcDogQWJzdHJhY3RDb250cm9sU3RhdGU8YW55PikgPT4gdXBkYXRlUmVjdXJzaXZlU2luZ2xlKHAsIHVwZGF0ZUZuKShzKSxcbiAgICAgIH0pLCB7fSBhcyBTdGF0ZVVwZGF0ZUZuczxhbnk+KTtcbiAgICAgIHN0YXRlID0gdXBkYXRlR3JvdXA8YW55Pih1cGRhdGVGdW5jdGlvbnMpKHN0YXRlKTtcbiAgICAgIHJldHVybiB1cGRhdGVGbihzdGF0ZSwgcGFyZW50KTtcbiAgICB9XG5cbiAgICBpZiAoaXNBcnJheVN0YXRlKHN0YXRlKSkge1xuICAgICAgc3RhdGUgPSB1cGRhdGVBcnJheTxhbnk+KChzLCBwKSA9PiB1cGRhdGVSZWN1cnNpdmVTaW5nbGUocCwgdXBkYXRlRm4pKHMpKShzdGF0ZSk7XG4gICAgICByZXR1cm4gdXBkYXRlRm4oc3RhdGUsIHBhcmVudCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHVwZGF0ZUZuKHN0YXRlLCBwYXJlbnQpO1xuICB9O1xufVxuXG4vKipcbiAqIFRoaXMgdXBkYXRlIGZ1bmN0aW9uIHRha2VzIGEgZm9ybSBhcnJheSBzdGF0ZSBhbmQgb25lIG9yIG1vcmUgdXBkYXRlXG4gKiBmdW5jdGlvbnMgYXBwbGllcyBhbGwgdXBkYXRlIGZ1bmN0aW9ucyBvbmUgYWZ0ZXIgYW5vdGhlciB0byB0aGUgc3RhdGVcbiAqIHJlY3Vyc2l2ZWx5LCBpLmUuIHRoZSBmdW5jdGlvbiBpcyBhcHBsaWVkIHRvIHRoZSBzdGF0ZSdzIGNoaWxkcmVuLFxuICogdGhlaXIgY2hpbGRyZW4gZXRjLlxuICpcbiAqIFRoZSBmb2xsb3dpbmcgZXhhbXBsZSB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gdmFsaWRhdGUgYWxsIGNvbnRyb2xzIGluIGFcbiAqIGdyb3VwIG9yIGFycmF5IGFzIHJlcXVpcmVkLlxuICpcbiBgYGB0eXBlc2NyaXB0XG4gY29uc3QgdXBkYXRlZFN0YXRlID0gdXBkYXRlUmVjdXJzaXZlKFxuICAgc3RhdGUsXG4gICB2YWxpZGF0ZTxhbnk+KHJlcXVpcmVkKSxcbiApO1xuIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUmVjdXJzaXZlPFRWYWx1ZT4oXG4gIHN0YXRlOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxUVmFsdWU+LFxuICB1cGRhdGVGbjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PixcbiAgLi4udXBkYXRlRm5BcnI6IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5bXVxuKTogRm9ybVN0YXRlPFRWYWx1ZT47XG5cbi8qKlxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgYSBmb3JtIGFycmF5IHN0YXRlIGFuZCBhbiBhcnJheSBvZlxuICogdXBkYXRlIGZ1bmN0aW9ucyBhcHBsaWVzIGFsbCB1cGRhdGUgZnVuY3Rpb25zIG9uZSBhZnRlciBhbm90aGVyIHRvIHRoZVxuICogc3RhdGUgcmVjdXJzaXZlbHksIGkuZS4gdGhlIGZ1bmN0aW9uIGlzIGFwcGxpZWQgdG8gdGhlIHN0YXRlJ3MgY2hpbGRyZW4sXG4gKiB0aGVpciBjaGlsZHJlbiBldGMuXG4gKlxuICogVGhlIGZvbGxvd2luZyBleGFtcGxlIHVzZXMgdGhpcyBmdW5jdGlvbiB0byB2YWxpZGF0ZSBhbGwgY29udHJvbHMgaW4gYVxuICogZ3JvdXAgb3IgYXJyYXkgYXMgcmVxdWlyZWQuXG4gKlxuYGBgdHlwZXNjcmlwdFxuY29uc3QgdXBkYXRlZFN0YXRlID0gdXBkYXRlUmVjdXJzaXZlKFxuICBzdGF0ZSxcbiAgW3ZhbGlkYXRlPGFueT4ocmVxdWlyZWQpXSxcbik7XG5gYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJlY3Vyc2l2ZTxUVmFsdWU+KFxuICBzdGF0ZTogQWJzdHJhY3RDb250cm9sU3RhdGU8VFZhbHVlPixcbiAgdXBkYXRlRm5BcnI6IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5bXSxcbik6IEZvcm1TdGF0ZTxUVmFsdWU+O1xuXG4vKipcbiAqIFRoaXMgdXBkYXRlIGZ1bmN0aW9uIHRha2VzIG9uZSBvciBtb3JlIHVwZGF0ZSBmdW5jdGlvbnMgYW5kIHJldHVybnMgYVxuICogcHJvamVjdGlvbiBmdW5jdGlvbiB0aGF0IGFwcGxpZXMgYWxsIHVwZGF0ZSBmdW5jdGlvbnMgb25lIGFmdGVyIGFub3RoZXIgdG9cbiAqIGEgZm9ybSBzdGF0ZS5cbiAqXG4gKiBUaGUgZm9sbG93aW5nIGV4YW1wbGUgdXNlcyB0aGlzIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIGFsbCBjb250cm9scyBpbiBhXG4gKiBncm91cCBhcyByZXF1aXJlZC5cbiAqXG5gYGB0eXBlc2NyaXB0XG5jb25zdCB1cGRhdGVGbiA9IHVwZGF0ZVJlY3Vyc2l2ZSh2YWxpZGF0ZTxhbnk+KHJlcXVpcmVkKSk7XG5jb25zdCB1cGRhdGVkU3RhdGUgPSB1cGRhdGVGbihzdGF0ZSk7XG5gYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJlY3Vyc2l2ZShcbiAgdXBkYXRlRm46IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj4sXG4gIC4uLnVwZGF0ZUZuQXJyOiBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+W11cbik6IDxUVmFsdWU+KHN0YXRlOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxUVmFsdWU+KSA9PiBGb3JtU3RhdGU8VFZhbHVlPjtcblxuLyoqXG4gKiBUaGlzIHVwZGF0ZSBmdW5jdGlvbiB0YWtlcyBhbiBhcnJheSBvZiB1cGRhdGUgZnVuY3Rpb25zIGFuZCByZXR1cm5zXG4gKiBhIHByb2plY3Rpb24gZnVuY3Rpb24gdGhhdCBhcHBsaWVzIGFsbCB1cGRhdGUgZnVuY3Rpb25zIG9uZSBhZnRlciBhbm90aGVyIHRvXG4gKiBhIGZvcm0gc3RhdGUuXG4gKlxuICogVGhlIGZvbGxvd2luZyBleGFtcGxlIHVzZXMgdGhpcyBmdW5jdGlvbiB0byB2YWxpZGF0ZSBhbGwgY29udHJvbHMgaW4gYVxuICogZ3JvdXAgYXMgcmVxdWlyZWQuXG4gKlxuYGBgdHlwZXNjcmlwdFxuY29uc3QgdXBkYXRlRm4gPSB1cGRhdGVSZWN1cnNpdmUoW3ZhbGlkYXRlPGFueT4ocmVxdWlyZWQpXSk7XG5jb25zdCB1cGRhdGVkU3RhdGUgPSB1cGRhdGVGbihzdGF0ZSk7XG5gYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJlY3Vyc2l2ZShcbiAgdXBkYXRlRm5BcnI6IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5bXSxcbik6IDxUVmFsdWU+KHN0YXRlOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxUVmFsdWU+KSA9PiBGb3JtU3RhdGU8VFZhbHVlPjtcblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJlY3Vyc2l2ZTxUVmFsdWU+KFxuICBzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXk6XG4gICAgfCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxUVmFsdWU+XG4gICAgfCBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+XG4gICAgfCBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+W10sXG4gIHVwZGF0ZUZuT3JVcGRhdGVGbkFycj86IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj4gfCBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+W10sXG4gIC4uLnJlc3Q6IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5bXVxuKSB7XG4gIGlmIChpc0Zvcm1TdGF0ZShzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXkpKSB7XG4gICAgY29uc3QgdXBkYXRlRm5BcnIgPSBBcnJheS5pc0FycmF5KHVwZGF0ZUZuT3JVcGRhdGVGbkFycikgPyB1cGRhdGVGbk9yVXBkYXRlRm5BcnIgOiBbdXBkYXRlRm5PclVwZGF0ZUZuQXJyIV07XG4gICAgcmV0dXJuIHVwZGF0ZUZuQXJyLmNvbmNhdCguLi5yZXN0KVxuICAgICAgLnJlZHVjZSgocywgdXBkYXRlRm4pID0+IHVwZGF0ZVJlY3Vyc2l2ZVNpbmdsZShzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXksIHVwZGF0ZUZuKShzKSwgc3RhdGVPckZ1bmN0aW9uT3JGdW5jdGlvbkFycmF5KTtcbiAgfVxuXG4gIGxldCB1cGRhdGVGbkFyciA9IEFycmF5LmlzQXJyYXkoc3RhdGVPckZ1bmN0aW9uT3JGdW5jdGlvbkFycmF5KSA/IHN0YXRlT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheSA6IFtzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXldO1xuICB1cGRhdGVGbkFyciA9IHVwZGF0ZUZuT3JVcGRhdGVGbkFyciA9PT0gdW5kZWZpbmVkID8gdXBkYXRlRm5BcnIgOiB1cGRhdGVGbkFyci5jb25jYXQodXBkYXRlRm5PclVwZGF0ZUZuQXJyKTtcbiAgcmV0dXJuIChzOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxUVmFsdWU+KSA9PiB1cGRhdGVSZWN1cnNpdmU8VFZhbHVlPihlbnN1cmVTdGF0ZShzKSwgdXBkYXRlRm5BcnIuY29uY2F0KHJlc3QpKTtcbn1cbiJdfQ==